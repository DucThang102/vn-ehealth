<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<meta name="description" content="" />
<meta name="author" content="" />

<title>Hệ thống bệnh án điện tử</title>

<!-- Custom fonts for this template-->
<link href="/css/fontawesome/all.css" rel="stylesheet" type="text/css" />
<link
  href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
  rel="stylesheet"
/>

<!-- Custom styles for this template-->
<link href="/css/bootstrap.css" rel="stylesheet" />
<link
  href="http://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css"
  rel="stylesheet"
/>
<link href="/css/style.css" rel="stylesheet" />
<script src="/js/jquery.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pc-bootstrap4-datetimepicker@4.17/build/js/bootstrap-datetimepicker.min.js"></script>
<link
  href="https://cdn.jsdelivr.net/npm/pc-bootstrap4-datetimepicker@4.17/build/css/bootstrap-datetimepicker.min.css"
  rel="stylesheet"
/>

<script src="/js/vue.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script src="https://unpkg.com/vuex@2.0.0"></script>
<script src="http://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/vue-bootstrap-datetimepicker@5"></script>

<script src="/js/common.js"></script>

<script>
  Vue.component("date-picker", VueBootstrapDatetimePicker);
</script>

<nav id="topbar" class="navbar navbar-expand bg-xanh">
  <div class="navbar-header1">
    <a class="navbar-brand1" href="/"
      ><img src="/images/logo_VEIG2.svg" height="50" alt=""
    /></a>
    <h5 class="text3">Hệ thống</h5>
    <h4 class="text4 MT0 MB0">Bệnh án điện tử</h4>
  </div>

  <ul class="navbar-nav top-bar ml-auto">
    <li class="nav-item dropdown no-arrow">
      <a class="nav-link" href="#">
        <img
          class="img-profile rounded-circle"
          src="/images/MediaObj_Placeholder.png"
        />
        <span id="username" class="ml-2 d-none d-lg-inline text-white"></span>
      </a>
    </li>

    <li class="nav-item dropdown no-arrow">
      <a
        class="nav-link"
        href="#"
        onclick="document.cookie='username=;path=/'; localStorage.removeItem('token'); location.href='/index.html';"
      >
        <i class="fas fa-fw fa-sign-out-alt"></i>
      </a>
    </li>
  </ul>
</nav>

<nav
  id="menubar"
  class="d-none navbar navbar-expand-lg navbar-light bg-white p-0"
>
  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link mt-1" href="/pages/dashboard.html"
        ><i class="fas fa-lg fa-home" style="color:blue"></i
      ></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/pages/patient/patient_search.html"
        >QUẢN LÝ BỆNH NHÂN</a
      >
    </li>
    <li id="tab_hsba" class="nav-item dropdown">
      <a
        class="nav-link dropdown-toggle text-uppercase"
        href="#"
        id="hsbaDropdown"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        HỒ SƠ BỆNH ÁN
      </a>
      <div class="dropdown-menu" aria-labelledby="hsbaDropdown">
        <a
          class="dropdown-item"
          id="hsba_chuaxuly"
          href="/pages/hsba/hs_chua_xl.html"
          ><i class="fas fa-angle-right black"></i> Chưa xử lý</a
        >
        <a
          class="dropdown-item"
          id="hsba_daluu"
          href="/pages/hsba/hs_da_luu.html"
          ><i class="fas fa-angle-right black"></i> Đã lưu</a
        >
        <a
          class="dropdown-item"
          id="hsba_cho_nhan"
          href="/pages/hsba/hs_cho_nhan_ngoai_vien.html"
          ><i class="fas fa-angle-right black"></i> Chờ nhận - HSBA ngoài
          viện</a
        >
        <a
          class="dropdown-item"
          id="hsba_da_nhan"
          href="/pages/hsba/hs_da_nhan_ngoai_vien.html"
          ><i class="fas fa-angle-right black"></i> Đã nhận - HSBA ngoài viện</a
        >
        <a
          class="dropdown-item"
          id="hsba_cap_ma"
          href="/pages/hsba/cap_ma_truy_cap.html"
          ><i class="fas fa-angle-right black"></i> Cấp mã truy cập</a
        >
        <a
          class="dropdown-item"
          id="hsba_vet_truycap"
          href="/pages/hsba/vet_truy_cap.html"
          ><i class="fas fa-angle-right black"></i> Vết truy cập HSBA</a
        >
        <a
          class="dropdown-item"
          id="hsba_vet_traodoi"
          href="/pages/hsba/vet_trao_doi.html"
          ><i class="fas fa-angle-right black"></i> Vết trao đổi HSBA</a
        >
      </div>
    </li>
    <li id="tab_dm" class="nav-item active dropdown">
      <a
        class="nav-link dropdown-toggle text-uppercase"
        href="#"
        id="hsbaDropdown"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Danh mục
      </a>
      <div class="dropdown-menu" aria-labelledby="hsbaDropdown">
        <a
          class="dropdown-item"
          id="dm_dungchung"
          href="/pages/danhmuc/dm_dungchung.html"
          ><i class="fas fa-angle-right black"></i> Dùng chung</a
        >
        <a
          class="dropdown-item"
          id="dm_chuan_hoa"
          href="/pages/danhmuc/dm_chuanhoa.html"
          ><i class="fas fa-angle-right black"></i> Danh sách danh mục chuẩn
          hóa</a
        >
      </div>
    </li>
  </ul>
</nav>

<script>
  function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(";");
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == " ") {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  $(document).ready(function() {
    var username = getCookie("username");
    $("#username").html(username);

    fetch(`${API_URL}/api/auth/get_permissions?username=${username}`)
      .then(res => res.json())
      .then(result => {
        var all = result["all"];
        if (!all) {
          var permissions = result["permissions"];
          var allow_tabs = permissions.map(x => x["tab"]);
          var allow_items = permissions.flatMap(x => x["items"]);

          $("#menubar .nav-item").each(function() {
            if (!allow_tabs.includes($(this).attr("id"))) {
              $(this).remove();
            }
          });

          $("#menubar .dropdown-item").each(function() {
            if (!allow_items.includes($(this).attr("id"))) {
              $(this).remove();
            }
          });
        }

        $("#menubar").removeClass("d-none");
      });
  });
</script>
